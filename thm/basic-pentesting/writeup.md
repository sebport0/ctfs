## Find the services exposed by the machine

I can use nmap for this

```
nmap $TIP

Starting Nmap 7.60 ( https://nmap.org ) at 2024-10-16 03:51 BST
Nmap scan report for ip-10-10-253-89.eu-west-1.compute.internal (10.10.253.89)
Host is up (0.00023s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8009/tcp open  ajp13
8080/tcp open  http-proxy
MAC Address: 02:ED:C9:2B:84:E1 (Unknown)

Nmap done: 1 IP address (1 host up) scanned in 1.68 seconds
```

We've found quite a bunch of open ports. Let's try them

### HTTP

If we go to the browser and use our target IP with port 80, the screen greet us with

![](/images/thm/basic-pentesting/0.png)

It doesn't look like much but the HTML has an interesting comment that, maybe, points to a new endpoint?

```html
<html>
  <h1>Undergoing maintenance</h1>
  <h4>Please check back later</h4>
  <!-- Check our dev note section if you need to know what to work on. -->
</html>
```

Maybe a quick dir enumeration will give us something new. Let's launch `gobuster`

```
~# gobuster dir -u /usr/share/wordlists/dirb/common.txt -u $TIP

===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.253.89
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirb/common.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2024/10/16 04:05:38 Starting gobuster
===============================================================
/.hta (Status: 403)
/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/development (Status: 301)
/index.html (Status: 200)
/server-status (Status: 403)
===============================================================
2024/10/16 04:05:38 Finished
===============================================================
```

_Note:_ `/usr/share/wordlists/` is a directory that contains usefuls word lists, and comes with a Kali Linux installation.

And it found something! `/development` returned a 301 Moved Permanently status code. Just for fun, let's where the `Location` header points

```
~# curl $TIP/development -i

HTTP/1.1 301 Moved Permanently
Date: Wed, 16 Oct 2024 03:24:24 GMT
Server: Apache/2.4.18 (Ubuntu)
Location: http://10.10.253.89/development/
Content-Length: 318
Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>301 Moved Permanently</title>
</head><body>
<h1>Moved Permanently</h1>
<p>The document has moved <a href="http://10.10.253.89/development/">here</a>.</p>
<hr>
<address>Apache/2.4.18 (Ubuntu) Server at 10.10.253.89 Port 80</address>
</body></html>
```

Nice. Let's go to `/development/` and see what is there

![](/images/thm/basic-pentesting/1.png)

We now know, as a bonus, that the web app is running Apache 2.4.18, in Ubuntu! There are two notes.
The first one tell us that

- There might be something like https://struts.apache.org/plugins/rest/ running, with version 2.5.12
- There is an SMB service running.

The second one reveals that the user J has a very weak password and points to /etc/shadow.

The thing running on port 8009 is AJP, which is a protocol optimized to work with Tomcat
and Apache.

```
~# nmap -p8009 -sV -sC $TIP

Starting Nmap 7.60 ( https://nmap.org ) at 2024-10-16 05:07 BST
Nmap scan report for ip-10-10-253-89.eu-west-1.compute.internal (10.10.253.89)
Host is up (0.00017s latency).

PORT STATE SERVICE VERSION
8009/tcp open ajp13 Apache Jserv (Protocol v1.3)
| ajp-methods:
|\_ Supported methods: GET HEAD POST OPTIONS
MAC Address: 02:ED:C9:2B:84:E1 (Unknown)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 7.27 seconds
```

Doesn't look useful at the moment. Let's go back and point our attention to the SMB client running in port 445.

```
~# smbclient -L $TIP
WARNING: The "syslog" option is deprecated
Enter WORKGROUP\root's password:

    Sharename       Type      Comment
    ---------       ----      -------
    Anonymous       Disk
    IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)

Reconnecting with SMB1 for workgroup listing.

    Server               Comment
    ---------            -------

    Workgroup            Master
    ---------            -------
    WORKGROUP            BASIC2
```

We have two shares `Anonymous` and `IPC$`
